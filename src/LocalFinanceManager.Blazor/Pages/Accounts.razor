@page "/accounts"
@inject LocalFinanceManager.Blazor.Services.AccountService AccountsApi

<h3>Accounts</h3>

<a class="btn btn-primary" href="/accounts/new">New Account</a>

@if (accounts == null)
{
    <p>Loading...</p>
}
else
{
    <table>
        <thead>
            <tr><th>Label</th><th>Type</th><th>Currency</th><th>Balance</th><th>Actions</th></tr>
        </thead>
        <tbody>
        @foreach (var a in accounts)
        {
            <tr>
                <td>@a.Label</td>
                <td>@a.Type</td>
                <td>@a.Currency</td>
                <td>@a.StartingBalance</td>
                <td>
                    <a href="/accounts/@a.Id/edit">Edit</a>
                    <button @onclick="() => Archive(a.Id)">Archive</button>
                </td>
            </tr>
        }
        </tbody>
    </table>
}

@code {
    private AccountDto[] accounts = Array.Empty<AccountDto>();

    protected override async System.Threading.Tasks.Task OnInitializedAsync()
    {
        accounts = await AccountsApi.GetAllAsync();
    }

    [Microsoft.AspNetCore.Components.Inject]
    public Microsoft.AspNetCore.Components.NavigationManager NavigationManager { get; set; } = null!;

    async System.Threading.Tasks.Task Archive(Guid id)
    {
        var ok = await AccountsApi.ArchiveAsync(id);
        if (ok) await OnInitializedAsync();
    }

    
}
